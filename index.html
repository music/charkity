<html>
<body>
<style>
body{
	background-color:rgba(184,38,26,.63);
	padding:0px;
	margin:0px;
}
.sendRec{
	position:absolute;
	background-color:white;
	width:100%;
	height:55px;
	/*background-color:green;*/
	top:75px;
	font-size:30px;
	color:grey;
}
#mainBox{
	background-color:rgba(184,38,26,1.0);
	width:100%;
	height:50%;
	position:relative;
	top:25%;
}
#balance{
	color:white;
	font-size:60px;
	/*background-color: green;*/
	position:relative;
	top:23px;
	margin:auto;
	width:50%;
	text-align:center;
}
#address{
	color:white;
	font-size:35px;
	/*background-color: green;*/
	position:relative;
	top:13px;
	margin:auto;
	width:50%;
	text-align:center;
}
#middleMain{
	width:60%;
	top:40px;
	/*background-color:green;*/
	height:200px;
	position:relative;
	margin:auto;
}
#recieve{
	position:absolute;
	font-size:27px;
	left:0%;
	width:75%;
	height:55px;
	border-radius:5px;
	border:none;
	top:0px;
	padding-left:5px;
}
#amount{
	padding-left:5px;
	position:absolute;
	font-size:27px;
	border-radius:5px;
	top:0px;
width:20%;
border:none;
right:0%;
height:55px;
}
#sendButton{
	width:100%;
	height:60px;
	font-size:30px;
	position:absolute;
	background-color:white;
	border-radius:5px;
	top:180px;
}
</style>
<script src="main.js"></script>
<script src="require.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.12.0/firebase.js"></script>

<div id="mainBox">
<div id="address">Address: <span id="myAddress"></span></div>
<div id="balance">Balance: <span id="myBalance"></span></div>
<div id="middleMain">
<input type="text" placeholder="Recipient's Address" id="recieve">
<br>
<input type="text" placeholder="# of Ark" id="amount">
<br>
	<select class="sendRec">
  <option value="choose">Choose a Charity to Support: </option>
  <option value="rc">American Red Cross</option>
  <option value="ph">Purple Heart</option>
  <option value="ww">Wounded Warriors</option>
  <option value="sj">St. Jude's Children Hospital</option>
</select>
<button onclick="sendTransaction()" id="sendButton">Send Ark!</button>
</div>

<script>
  function sendTransaction() {
    var seed = window.user.seed;
    var amount = window.user.amount;
    var address = window.user.address;
    
    var precision = Math.pow(10, 1);
    var final_amount = Math.ceil(amount * precision) / precision;

    var difference = (final_amount - amount).toFixed(8);
    console.log("difference = " + difference);

    var charity = difference * Math.pow(10, 8);

    amount = parseInt(amount * 100000000);
    // send to actual recipient
    arkAPI.sendTransaction(
      seed,
      "ignore",
      null,
      amount,
      address,
      function(error, success, response) {
        console.log(response);
    });

    // send remainder to charity
    arkAPI.sendTransaction(
      seed,
      "ignore",
      null,
      charity,
      "DJ4uHVUCa5f83Y4Y3BFqUyRL47k2cWXkgE",
      function(error, success, response) {
        console.log(response);
    });
  }

  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyCXak386757EoosAb2vII2svD9hnUyasUs",
    authDomain: "charkity-2db46.firebaseapp.com",
    databaseURL: "https://charkity-2db46.firebaseio.com",
    projectId: "charkity-2db46",
    storageBucket: "charkity-2db46.appspot.com",
    messagingSenderId: "88663340604"
  };
  firebase.initializeApp(config);
  var database = firebase.database();


  firebase.auth().onAuthStateChanged(function(user) {
  	alert(user);
    if (user) {
      // User is signed in.
      window.user = user;
      var displayName = user.displayName;
      var email = user.email;
      var emailVerified = user.emailVerified;
      var photoURL = user.photoURL;
      var isAnonymous = user.isAnonymous;
      var uid = user.uid;
      var providerData = user.providerData;
      var userSeed = user.seed;
      var userAddress = user.address;
      // alert(uid);
      // ...
    } else {
      // User is signed out.
      // ...
    }
  });

  function loginUser(){
    firebase.auth().signInWithEmailAndPassword(document.getElementById('loginEmail').value, document.getElementById('loginPassword')).catch(function(error) {
      // Handle Errors here.
      var errorCode = error.code;
      var errorMessage = error.message;

      // window.location.href = "http://stackoverflow.com";
      // ...
    });
  }
</script>

</body>
</html>
